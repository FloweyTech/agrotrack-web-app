<div class="report-list-container">
  <div class="header-section">
    <h2>{{ 'report.title' | translate }}</h2>
    <button mat-raised-button class="refresh-button" (click)="reload()">
      {{ 'report.refresh' | translate }}
    </button>
  </div>

  <div class="filters">
    <label for="orgFilter">{{ 'report.filterBy' | translate }}</label>
    <select id="orgFilter" (change)="filterByOrganization($event)">
      <option value="">{{ 'report.allOrganizations' | translate }}</option>
      <option *ngFor="let orgId of organizations" [value]="orgId">
        {{ 'Organization ' + orgId }}
      </option>
    </select>
  </div>

  <p *ngIf="store.loading()" class="loading-text">{{ 'report.loading' | translate }}</p>

  <table *ngIf="!store.loading()" mat-table [dataSource]="filteredReports" class="mat-elevation-z2">

    <ng-container matColumnDef="id">
      <th mat-header-cell *matHeaderCellDef>{{ 'report.columns.id' | translate }}</th>
      <td mat-cell *matCellDef="let r">{{ r.id }}</td>
    </ng-container>

    <ng-container matColumnDef="organizationId">
      <th mat-header-cell *matHeaderCellDef>{{ 'report.columns.organization' | translate }}</th>
      <td mat-cell *matCellDef="let r">{{ r.organizationId }}</td>
    </ng-container>

    <ng-container matColumnDef="type">
      <th mat-header-cell *matHeaderCellDef>{{ 'report.columns.type' | translate }}</th>
      <td mat-cell *matCellDef="let r">{{ ('report.types.' + r.type) | translate }}</td>
    </ng-container>

    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef>{{ 'report.columns.status' | translate }}</th>
      <td mat-cell *matCellDef="let r" [class]="'status-' + r.status.toLowerCase()">
        {{ ('report.statuses.' + r.status) | translate }}
      </td>
    </ng-container>

    <ng-container matColumnDef="period">
      <th mat-header-cell *matHeaderCellDef>{{ 'report.columns.period' | translate }}</th>
      <td mat-cell *matCellDef="let r">
        {{ r.periodStart | date: 'dd/MM/yyyy' }} - {{ r.periodEnd | date: 'dd/MM/yyyy' }}
      </td>
    </ng-container>

    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>{{ 'report.columns.actions' | translate }}</th>
      <td mat-cell *matCellDef="let r">
        <button *ngIf="r.status !== 'GENERATED'" mat-raised-button color="primary" (click)="generate(r)">
          {{ 'report.actions.generate' | translate }}
        </button>
        <a mat-raised-button color="accent" [routerLink]="[r.id]">
          {{ 'report.actions.viewDetail' | translate }}
        </a>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>
</div>
